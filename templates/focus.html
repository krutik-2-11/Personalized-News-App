<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Focused News</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
  <style>
    .chip{display:inline-block;padding:.35rem .6rem;border-radius:999px;background:#1f2937;color:#e5e7eb;
      font-size:.9rem;margin:.25rem .35rem 0 0;border:1px solid #2b3747}
    .chip a{color:#93c5fd;text-decoration:none}
    .chip a:hover{text-decoration:underline}
    .help{color:#9ca3af}
  </style>
</head>
<body class="bg-slate text-slate">
  <div class="container py-3">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h3 class="m-0">üéØ Focused News</h3>
      <a class="btn btn-outline-light btn-sm" href="{{ url_for('index') }}">‚Üê Home</a>
    </div>

    <form method="POST" action="{{ url_for('focused.focus_home') }}" class="mb-3">
      <label class="form-label"><strong>Watchlist tags</strong> (comma or newline, e.g., <em>NVDA, AMZN, TSLA</em>)</label>
      <textarea class="form-control" name="tags" rows="2" placeholder="Add tickers or topics‚Ä¶">{{ ", ".join(tags) }}</textarea>

      <div class="help mt-2">
        Save tags to keep a watchlist. Click a tag chip below to run a summary for that name.
        Use the search box for ad-hoc one-offs.
      </div>

      <div class="row mt-3 g-2">
        <div class="col-md-6">
          <label class="form-label me-2"><strong>Result filter</strong></label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="result_filter" id="res_fin" value="finance" {% if result_filter == 'finance' %}checked{% endif %}>
            <label class="form-check-label" for="res_fin">Finance (portfolio-grade)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="result_filter" id="res_gen" value="general" {% if result_filter != 'finance' %}checked{% endif %}>
            <label class="form-check-label" for="res_gen">General</label>
          </div>
        </div>
        <div class="col-md-6">
          <label class="form-label me-2"><strong>Summary mode</strong></label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="summary_mode" id="mode_ex" value="extractive" {% if summary_mode != 'llm' %}checked{% endif %}>
            <label class="form-check-label" for="mode_ex">Fast (no API)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="summary_mode" id="mode_llm" value="llm" {% if summary_mode == 'llm' %}checked{% endif %} {% if not use_llm %}disabled{% endif %}>
            <label class="form-check-label" for="mode_llm">LLM{% if not use_llm %} (set OPENAI_API_KEY to enable){% endif %}</label>
          </div>
        </div>
      </div>

      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-primary btn-sm" type="submit">Save</button>
        <a class="btn btn-outline-light btn-sm" href="{{ url_for('focused.focus_home') }}">Reset</a>
      </div>
    </form>

    {% if tags %}
      <div class="mb-3">
        {% for t in tags %}
          <span class="chip"># {{ t }} ¬∑ <a href="{{ url_for('focused.focus_search') }}?q={{ t }}">Summarize</a></span>
        {% endfor %}
      </div>
    {% endif %}

    <form class="mb-4" method="GET" action="{{ url_for('focused.focus_search') }}">
      <div class="input-group">
        <input name="q" type="text" class="form-control" placeholder="Search a topic/company (e.g., Microsoft, AMZN)" required>
        <button class="btn btn-success" type="submit">Search & Summarize</button>
      </div>
      <div class="help mt-2">Tip: this does not change your saved tags. Use it for one-off checks.</div>
    </form>

    {% for tag, articles in tag_results.items() %}
      <div class="mt-4">
        <div class="d-flex align-items-baseline gap-2 mb-2">
          <h4 class="topic-tag"># {{ tag }}</h4>
          <a class="btn btn-link btn-sm p-0 ms-2" href="{{ url_for('focused.focus_search') }}?q={{ tag }}">Summarize</a>
        </div>
        {% if articles %}
          <div class="list-group">
            {% for a in articles %}
              <a class="list-group-item list-group-item-action bg-dark text-light" href="{{ a.link }}" target="_blank" rel="noopener">
                <div class="d-flex w-100 justify-content-between">
                  <h6 class="mb-1">{{ a.title }}</h6>
                  <small class="text-secondary">{{ a.domain or a.source }}</small>
                </div>
                {% if a.summary %}<p class="mb-1 text-secondary">{{ a.summary[:200] }}{% if a.summary|length > 200 %}‚Ä¶{% endif %}</p>{% endif %}
              </a>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-secondary">No recent items found for this tag. Try switching to <em>General</em> and click Save.</div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</body>
</html>
